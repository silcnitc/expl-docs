<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Compiler Lab website for NIT Calicut"><link href=https://silcnitc.github.io/expl-docs/roadmap/stage-05/ rel=canonical><link href=../stage-04/ rel=prev><link href=../stage-06/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.31"><title>Stage 5: Adding Functions - EXPL NIT-C</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=purple data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#stage-5-adding-functions class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <b>Site is undergoing migration.</b> Old URL: <a href=https://silcnitc.github.io target=_blank target=_blank rel="nofollow noopener">https://silcnitc.github.io</a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="EXPL NIT-C" class="md-header__button md-logo" aria-label="EXPL NIT-C" data-md-component=logo> <img src=../../img/nitc-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EXPL NIT-C </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Stage 5: Adding Functions </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=purple data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=purple data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../about/philosophy/ class=md-tabs__link> About </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Roadmap </a> </li> <li class=md-tabs__item> <a href=../../documentation/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../../feedback/ class=md-tabs__link> Student Feedback </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="EXPL NIT-C" class="md-nav__button md-logo" aria-label="EXPL NIT-C" data-md-component=logo> <img src=../../img/nitc-logo.png alt=logo> </a> EXPL NIT-C </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../about/philosophy/ class=md-nav__link> <span class=md-ellipsis> Philosophy </span> </a> </li> <li class=md-nav__item> <a href=../../about/authors/ class=md-nav__link> <span class=md-ellipsis> Authors </span> </a> </li> <li class=md-nav__item> <a href=../../about/license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Roadmap </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Roadmap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Roadmap </span> </a> </li> <li class=md-nav__item> <a href=../stage-00/ class=md-nav__link> <span class=md-ellipsis> Stage 0 </span> </a> </li> <li class=md-nav__item> <a href=../stage-01/ class=md-nav__link> <span class=md-ellipsis> Stage 1 </span> </a> </li> <li class=md-nav__item> <a href=../stage-02/ class=md-nav__link> <span class=md-ellipsis> Stage 2 </span> </a> </li> <li class=md-nav__item> <a href=../stage-03/ class=md-nav__link> <span class=md-ellipsis> Stage 3 </span> </a> </li> <li class=md-nav__item> <a href=../stage-04/ class=md-nav__link> <span class=md-ellipsis> Stage 4 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Stage 5 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Stage 5 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#test-programs class=md-nav__link> <span class=md-ellipsis> Test Programs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../stage-06/ class=md-nav__link> <span class=md-ellipsis> Stage 6 </span> </a> </li> <li class=md-nav__item> <a href=../stage-07/ class=md-nav__link> <span class=md-ellipsis> Stage 7 </span> </a> </li> <li class=md-nav__item> <a href=../stage-08/ class=md-nav__link> <span class=md-ellipsis> Stage 8 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../codegen/ class=md-nav__link> <span class=md-ellipsis> Code Generation </span> </a> </li> <li class=md-nav__item> <a href=../../abi/ class=md-nav__link> <span class=md-ellipsis> Application Binary Interface </span> </a> </li> <li class=md-nav__item> <a href=../../libinterface/ class=md-nav__link> <span class=md-ellipsis> Library Implementation </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> ExPL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> ExPL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../expl/ class=md-nav__link> <span class=md-ellipsis> ExpL Specification </span> </a> </li> <li class=md-nav__item> <a href=../../grammar-outline/ class=md-nav__link> <span class=md-ellipsis> ExpL Grammar Outline </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_3> <label class=md-nav__link for=__nav_4_5_3 id=__nav_4_5_3_label tabindex=0> <span class=md-ellipsis> Compile Time Data Structures for ExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_3> <span class="md-nav__icon md-icon"></span> Compile Time Data Structures for ExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../data-structures/ class=md-nav__link> <span class=md-ellipsis> Compile Time Data Structures for ExpL </span> </a> </li> <li class=md-nav__item> <a href=../../data_structures/abstract-syntax-tree/ class=md-nav__link> <span class=md-ellipsis> Abstract Syntax Tree </span> </a> </li> <li class=md-nav__item> <a href=../../data_structures/type-table/ class=md-nav__link> <span class=md-ellipsis> Type Table </span> </a> </li> <li class=md-nav__item> <a href=../../data_structures/global-symbol-table/ class=md-nav__link> <span class=md-ellipsis> Global Symbol Table </span> </a> </li> <li class=md-nav__item> <a href=../../data_structures/local-symbol-table/ class=md-nav__link> <span class=md-ellipsis> Local Symbol Table </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_4> <label class=md-nav__link for=__nav_4_5_4 id=__nav_4_5_4_label tabindex=0> <span class=md-ellipsis> Run Time Data Structures for ExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_4> <span class="md-nav__icon md-icon"></span> Run Time Data Structures for ExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../run-data-structures/ class=md-nav__link> <span class=md-ellipsis> Run Time Data Structures for ExpL </span> </a> </li> <li class=md-nav__item> <a href=../../run_data_structures/heap/ class=md-nav__link> <span class=md-ellipsis> Heap Allocation </span> </a> </li> <li class=md-nav__item> <a href=../../run_data_structures/register/ class=md-nav__link> <span class=md-ellipsis> Register Allocation </span> </a> </li> <li class=md-nav__item> <a href=../../run_data_structures/run-time-stack/ class=md-nav__link> <span class=md-ellipsis> Stack Allocation </span> </a> </li> <li class=md-nav__item> <a href=../../run_data_structures/static-allocation/ class=md-nav__link> <span class=md-ellipsis> Static Allocation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_5> <label class=md-nav__link for=__nav_4_5_5 id=__nav_4_5_5_label tabindex=0> <span class=md-ellipsis> ExPL Test Programs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_5> <span class="md-nav__icon md-icon"></span> ExPL Test Programs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../testprograms/ class=md-nav__link> <span class=md-ellipsis> Test Programs </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-01/ class=md-nav__link> <span class=md-ellipsis> Program 1 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-02/ class=md-nav__link> <span class=md-ellipsis> Program 2 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-03/ class=md-nav__link> <span class=md-ellipsis> Program 3 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-04/ class=md-nav__link> <span class=md-ellipsis> Program 4 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-05/ class=md-nav__link> <span class=md-ellipsis> Program 5 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-06/ class=md-nav__link> <span class=md-ellipsis> Program 6 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-07/ class=md-nav__link> <span class=md-ellipsis> Program 7 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-08/ class=md-nav__link> <span class=md-ellipsis> Program 8 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-09/ class=md-nav__link> <span class=md-ellipsis> Program 9 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-10/ class=md-nav__link> <span class=md-ellipsis> Program 10 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-11/ class=md-nav__link> <span class=md-ellipsis> Program 11 </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/test-program-12/ class=md-nav__link> <span class=md-ellipsis> Program 12 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_5_14> <label class=md-nav__link for=__nav_4_5_5_14 id=__nav_4_5_5_14_label tabindex=0> <span class=md-ellipsis> Stage 4 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_4_5_5_14_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_5_14> <span class="md-nav__icon md-icon"></span> Stage 4 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../testprograms/stage4/bubblesort/ class=md-nav__link> <span class=md-ellipsis> Bubble Sort </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/stage4/fibaofn/ class=md-nav__link> <span class=md-ellipsis> Fibonacci </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/stage4/prime/ class=md-nav__link> <span class=md-ellipsis> Prime </span> </a> </li> <li class=md-nav__item> <a href=../../testprograms/stage4/sum-to-n-fact/ class=md-nav__link> <span class=md-ellipsis> Sum to n! </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> <span class=md-ellipsis> OExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> OExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oexpl-specification/ class=md-nav__link> <span class=md-ellipsis> OExpL Specification </span> </a> </li> <li class=md-nav__item> <a href=../../oexpl-grammar-outline/ class=md-nav__link> <span class=md-ellipsis> OExpL Grammar Outline </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6_3> <label class=md-nav__link for=__nav_4_6_3 id=__nav_4_6_3_label tabindex=0> <span class=md-ellipsis> Compile Time Data Structures for OExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6_3> <span class="md-nav__icon md-icon"></span> Compile Time Data Structures for OExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oexpl-data-structures/ class=md-nav__link> <span class=md-ellipsis> Compile Time Data Structures for OExpL </span> </a> </li> <li class=md-nav__item> <a href=../../oexpl_data_structures/class-table/ class=md-nav__link> <span class=md-ellipsis> Class Table </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6_4> <label class=md-nav__link for=__nav_4_6_4 id=__nav_4_6_4_label tabindex=0> <span class=md-ellipsis> Run Time Data Structures for OExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6_4> <span class="md-nav__icon md-icon"></span> Run Time Data Structures for OExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oexpl-run-data-structures/ class=md-nav__link> <span class=md-ellipsis> Run Time Data Structures for OExpL </span> </a> </li> <li class=md-nav__item> <a href=../../oexpl_runtime_data_structures/virtual_function_table/ class=md-nav__link> <span class=md-ellipsis> Virtual Function Table </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../oexpl-runtime-binding-tutorial/ class=md-nav__link> <span class=md-ellipsis> OExPL Runtime Binding </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6_6> <label class=md-nav__link for=__nav_4_6_6 id=__nav_4_6_6_label tabindex=0> <span class=md-ellipsis> OExPL Test Programs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6_6> <span class="md-nav__icon md-icon"></span> OExPL Test Programs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../oexpl-testprograms/ class=md-nav__link> <span class=md-ellipsis> OExPL Test Programs </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test1/ class=md-nav__link> <span class=md-ellipsis> Program 1 </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test2/ class=md-nav__link> <span class=md-ellipsis> Program 2 </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test3/ class=md-nav__link> <span class=md-ellipsis> Program 3 </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test4/ class=md-nav__link> <span class=md-ellipsis> Program 4 </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test5/ class=md-nav__link> <span class=md-ellipsis> Program 5 </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test6/ class=md-nav__link> <span class=md-ellipsis> Program 6 </span> </a> </li> <li class=md-nav__item> <a href=../../oexpltestprograms/test7/ class=md-nav__link> <span class=md-ellipsis> Program 7 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex=0> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../lex/ class=md-nav__link> <span class=md-ellipsis> Using LEX </span> </a> </li> <li class=md-nav__item> <a href=../../yacc/ class=md-nav__link> <span class=md-ellipsis> Using YACC </span> </a> </li> <li class=md-nav__item> <a href=../../ywl/ class=md-nav__link> <span class=md-ellipsis> Using YACC with LEX </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7_4> <label class=md-nav__link for=__nav_4_7_4 id=__nav_4_7_4_label tabindex=0> <span class=md-ellipsis> GDB </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7_4> <span class="md-nav__icon md-icon"></span> GDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gdb/ class=md-nav__link> <span class=md-ellipsis> Using GDB </span> </a> </li> <li class=md-nav__item> <a href=../../gdb-files/ class=md-nav__link> <span class=md-ellipsis> GDB Input Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../label-translation/ class=md-nav__link> <span class=md-ellipsis> Label Translation </span> </a> </li> <li class=md-nav__item> <a href=../../install/ class=md-nav__link> <span class=md-ellipsis> XSM Simulator Installation </span> </a> </li> <li class=md-nav__item> <a href=../../xsmusagespec/ class=md-nav__link> <span class=md-ellipsis> XSM Simulator Instructions </span> </a> </li> <li class=md-nav__item> <a href=../../xsm-environment-tut/ class=md-nav__link> <span class=md-ellipsis> XSM Environment Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../library-implementation/ class=md-nav__link> <span class=md-ellipsis> Library Implementation </span> </a> </li> <li class=md-nav__item> <a href=../../attribute/ class=md-nav__link> <span class=md-ellipsis> Attribute Synthesis </span> </a> </li> <li class=md-nav__item> <a href=../../Data_Structures/ class=md-nav__link> <span class=md-ellipsis> Data Structures for ExpL Compilation/Interpretation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex=0> <span class=md-ellipsis> Misc </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ex1/ class=md-nav__link> <span class=md-ellipsis> Exercise 1 </span> </a> </li> <li class=md-nav__item> <a href=../../explusagespec/ class=md-nav__link> <span class=md-ellipsis> ExPL Usage spec? </span> </a> </li> <li class=md-nav__item> <a href=../../libinterfaceexpl/ class=md-nav__link> <span class=md-ellipsis> ExPL Library Interface? </span> </a> </li> <li class=md-nav__item> <a href=../../help/ class=md-nav__link> <span class=md-ellipsis> help </span> </a> </li> <li class=md-nav__item> <a href=../../oexpl/ class=md-nav__link> <span class=md-ellipsis> OExPL </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Student Feedback </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Student Feedback </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../feedback/ class=md-nav__link> <span class=md-ellipsis> Student Feedback </span> </a> </li> <li class=md-nav__item> <a href=../../feedback/nitc-winter-2021/ class=md-nav__link> <span class=md-ellipsis> NIT-C Winter 2021 </span> </a> </li> <li class=md-nav__item> <a href=../../feedback/nitc-winter-2017/ class=md-nav__link> <span class=md-ellipsis> NIT-C Winter 2017 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#test-programs class=md-nav__link> <span class=md-ellipsis> Test Programs </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=stage-5-adding-functions>Stage 5: Adding Functions<a class=headerlink href=#stage-5-adding-functions title="Permanent link">&para;</a></h1> <div class="admonition quote"> <p class=admonition-title>Time estimate</p> <p>2 weeks, 5-10 hours/week</p> </div> <div class="admonition abstract"> <p class=admonition-title>Prerequisites</p> <p>You must read the following documents before proceeding with this stage:</p> <ol> <li>The main page of the document <a href=../../run-data-structures/ >Run time allocation</a>.</li> <li><a href=../../run_data_structures/run-time-stack/ >Run time stack Allocation</a>.</li> </ol> </div> <div class="admonition example"> <p class=admonition-title>Learning Objectives</p> <p>You will extend the language of Stage 4 by adding functions with support for recursion. Addition of functions to the language requires handling <strong>scope</strong> of variables. Support for recursion demands <strong>run-time storage allocation</strong>. Only <em>integer</em> and <em>string</em> type variables will be supported.</p> </div> <p>This is the first major stage in the ExpL project. A skeletal outline of the syntax rules for defining the extension of the language of Stage 4 to support subroutines is as below. You are required to fill in rules required to complete the grammar. Note that variables may be only of type integer/string.</p> <div class=highlight><pre><span></span><code><span class=n>Program</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>GDeclBlock</span><span class=w> </span><span class=n>FdefBlock</span><span class=w> </span><span class=n>MainBlock</span>
<span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>GdeclBlock</span><span class=w> </span><span class=n>MainBlock</span>
<span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>MainBlock</span>

<span class=n>GdeclBlock</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>DECL</span><span class=w> </span><span class=n>GdeclList</span><span class=w> </span><span class=n>ENDDECL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>DECL</span><span class=w> </span><span class=n>ENDDECL</span>

<span class=n>GdeclList</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>GDeclList</span><span class=w> </span><span class=n>GDecl</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>GDecl</span>
<span class=n>GDecl</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>Type</span><span class=w> </span><span class=n>GidList</span><span class=w> </span><span class=p>;</span>

<span class=n>GidList</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>GidList</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>Gid</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Gid</span>

<span class=n>Gid</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>ID</span>
<span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>ID</span><span class=err>\</span><span class=p>[</span><span class=n>NUM</span><span class=err>\</span><span class=p>]</span>
<span class=w>     </span><span class=o>|</span><span class=w> </span><span class=n>ID</span><span class=p>(</span><span class=n>ParamList</span><span class=p>)</span>
<span class=o>--------------------------------------------------------------------------------------</span>
<span class=n>FDefBlock</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>FdefBlock</span><span class=w> </span><span class=n>Fdef</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Fdef</span>

<span class=n>Fdef</span><span class=w> </span><span class=o>::=</span><span class=n>Type</span><span class=w> </span><span class=n>ID</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>ParamList</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>LdeclBlock</span><span class=w> </span><span class=n>Body</span><span class=w> </span><span class=p>}</span>

<span class=n>ParamList</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>ParamList</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>Param</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>Param</span>
<span class=w>        </span><span class=o>|</span><span class=w>   </span><span class=o>/</span><span class=err>\</span><span class=o>*</span><span class=n>param</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>empty</span><span class=err>\</span><span class=o>*/</span>

<span class=n>Param</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>Type</span><span class=w> </span><span class=n>ID</span>

<span class=n>Type</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>INT</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>STR</span>
<span class=o>-----------------------------------------------------------------------------------------</span>

<span class=n>LdeclBlock</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>DECL</span><span class=w> </span><span class=n>LDecList</span><span class=w> </span><span class=n>ENDDECL</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>DECL</span><span class=w> </span><span class=n>ENDDECL</span>

<span class=n>LDecList</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>LDecList</span><span class=w> </span><span class=n>LDecl</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>LDecl</span>

<span class=n>LDecl</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>Type</span><span class=w> </span><span class=n>IdList</span><span class=w> </span><span class=p>;</span>

<span class=n>IdList</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>IdList</span><span class=p>,</span><span class=w> </span><span class=n>ID</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>ID</span>

<span class=n>Type</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>INT</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>STR</span>

<span class=n>Since</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=n>call</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>treated</span><span class=w> </span><span class=n>as</span><span class=w> </span><span class=n>an</span><span class=w> </span><span class=n>expression</span><span class=w> </span><span class=p>(</span><span class=n>whose</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=n>is</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=n>of</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>function</span><span class=p>),</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>following</span><span class=w> </span><span class=n>rules</span><span class=w> </span><span class=n>must</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>added</span><span class=o>:</span>

<span class=n>E</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>ID</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>ID</span><span class=p>(</span><span class=n>ArgList</span><span class=p>)</span>

<span class=n>ArgList</span><span class=w> </span><span class=o>::=</span><span class=w> </span><span class=n>ArgList</span><span class=p>,</span><span class=w> </span><span class=n>E</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>E</span>
</code></pre></div> <p>Here is an <a href=../../run_data_structures/run-time-stack/#nav-illustration>example</a> for a program with a function. We will take up semantic analysis and AST representation before proceeding to code generation.</p> <p>Each function requires a <strong>declaration</strong>. The declaration of functions must be made along with the global declarations. The declaration of a function must specify the types and names of the <strong>formal parameters</strong> and the <strong>return type</strong> of the function. The compiler must store the declaration information in the global symbol table. For example, the declaration</p> <div class=highlight><pre><span></span><code><span class=n>decl</span>
<span class=p>..</span>
<span class=p>..</span>
<span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>factorial</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>);</span>
<span class=p>..</span>
<span class=p>..</span>
<span class=n>enddecl</span>
</code></pre></div> <p>specifies that <em>factorial</em> is a function that takes as input one integer argument and returns an integer. This is sometimes called the <strong>signature</strong> of the function. Conceptually, to invoke the factorial function, the <strong>caller</strong> must know:</p> <ol> <li>The memory address to which the function call must be directed (<strong>binding</strong>).</li> <li>The <strong>types and names of the formal parameters</strong> to the function and the order in which the actual <strong>arguments</strong> must be given as input to the function.</li> <li>The <strong>return type</strong> of the function.</li> </ol> <p>This precisely is the information that the symbol table stores.</p> <p>A function <strong>definition</strong> contains:</p> <p>a. The function's signature. b. The declaration of <strong>local variables</strong> of the function. c. The code of the function.</p> <p>For example, the definition of the factorial function could be as: <div class=highlight><pre><span></span><code>int factorial(int n){
 decl
  int f;
 enddecl
 begin
  if( n==1 || n==0 ) then
   f = 1;
  else
   f = n * factorial(n-1);
  endif;
 return f;
 end
}
</code></pre></div></p> <p>Local variables declared in a function are <em>visible only</em> within the function. We say that the <strong>scope</strong> of a local declaration is limited to the function. Moreover, if a global variable is redeclared inside a function, <em>the local declaration overrides the global declaration</em>.</p> <p>Thus, we have two kinds of variables. Global variables that are visible "everywhere" (or having a <strong>global scope</strong>) and local variables that are visible only within the functions (or having a <strong>local scope</strong>) where they are declared.</p> <p>The compiler needs to know the binding addresses and types of the local variables for translation of statements of the function to assembly code. However, this information is irrelevant outside the function.</p> <p>To keep track of the local variable and scope information, our strategy is to keep global and local variables in different symbol tables. We will have</p> <ul> <li> <p>1. A single <strong>global symbol table</strong> storing the <em>(name, type, size, binding)</em> information of global variables as well as <em>(name, type, parameters, binding)</em> information for functions. The following structure is suggested for storing a global symbol table entry.</p> <p><strong>struct Gsymbol{</strong>   <strong>char *name;</strong> //name of the variable or function   <strong>int type;</strong> //type of the variable:(Integer / String)   <strong>int size;</strong> //size of an array   <strong>int binding;</strong> //static binding of global variables   <strong>struct Paramstruct *paramlist;</strong>//pointer to the head of the formal parameter list                    //in the case of functions   <strong>int flabel;</strong> //a label for identifying the starting address of a function's code   <strong>struct Gsymbol *next;</strong> //points to the next Global Symbol Table entry <strong>};</strong></p> </li> <li> <p>2. Several <strong>local symbol tables</strong> - one for each function containing the <em>(name, type, binding)</em> information for each local variable of the function. (Note that since the language does not permit arrays to be defined within a function, the size value of local variables is always 1, hence the field is not required). A local symbol table entry can be stored in the following structure:</p> </li> </ul> <p><strong>struct Lsymbol{</strong>   <strong>char *name;</strong>     //name of the variable   <strong>int type;</strong>    //type of the variable:(Integer / String)   <strong>int binding;</strong>     //local binding of the variable   <strong>struct Lsymbol *next;</strong>   //points to the next Local Symbol Table entry <strong>};</strong></p> <p><strong>Note:</strong> As noted in the <a href=../../run-data-structures/ >run time storage allocation</a> documentation, local variables cannot be assigned static memory addresses. Hence, the binding of a local variable is a relative address within the function's activation record. We will discuss this matter in detail later.</p> <p>What is the <strong>stored in flabel</strong>? When the compiler generates code for the function, a label is placed at the start of the function. A call to the function is translated to a low-level CALL to the corresponding label. Later, the label has to be replaced by the address of the instruction during the <a href=../../label-translation/ >label translation phase</a>.</p> <p>The simple scheme we suggest here is to put the label F0 before the code of the first function declared in the program, F1 before the code of the second and so on. Hence, in the flabel field of the first function, store 0. Similarly, store 1 in the flabel field of the second function and so on. A call to the first function must be translated to CALL F0 and so on.</p> <p>With this, the global symbol table for the <a href=../../run_data_structures/run-time-stack/#nav-illustration>program</a> would be as below.</p> <p><img alt src=../../img/gsymboltable3.png></p> <p>Continuing with the above example, we need two local symbol tables – one for the main function and one for the factorial function. The local symbol table holds the (name, type, binding) triple for each <strong>formal parameter</strong> as well as <strong>local variables</strong> of the function. We will discuss the binding of formal parameters and local variables later. The local symbol tables of main and factorial would look as the following:</p> <p><img alt src=../../img/localsymboltable2.png></p> <p><img alt src=../../img/localsymboltable1.png></p> <p>See <a href=../../data_structures/local-symbol-table/ >LINK</a> for more details. For now, ignore the type table pointer in the structure given in the link. This will be discussed in the next stage.</p> <p><strong>Task 1</strong>: Complete the program to build the global symbol table. Test your program by printing out all global declarations in the program by displaying the contents of the symbol table. You must not permit two variables/functions (or a function and a variable) to have the same name.</p> <p>Our next aim is to perform semantic analysis, build the AST and then generate code. The strategy will be the following:</p> <ul> <li>1. First, parse global declarations and create the global symbol table entries for functions andglobal variables (Already completed as Task 1)</li> <li>2. For each function for which code is not yet generated<ul> <li>a) Check for <strong>name equivalence</strong> of the formal parameters of the function definition with the declaration. Name equivalence requires that the type and name of each formal parameter of the function in the declaration and the definition must agree.</li> <li>b) Create local symbol table containing local variables and parameters.</li> <li>c) Build AST for the function. (Do type-checking when the tree is being built, as was done in the previous stages.)</li> <li>d) Recursively traverse the tree and generate code for the function in the target file.</li> </ul> </li> </ul> <p><strong>After generating code for a function, the local symbol table and the abstract syntax tree for the function can be deallocated.</strong> Proceed to step 2 for the next function.</p> <p>Note that the code and the local variables of a function are not visible outside the function. Hence, the local symbol table and the AST for a function are not required once the code is generated. <strong>To generate code for calling one function from another function, only the global symbol table information of the callee is needed. The global symbol table is maintained throughout the compilation process.</strong> Note that the main function is just like any other function except that it has no arguments, its name must be <em>main</em> and return type must be <em>int</em> as per the specification.</p> <p>The only non-trivial part about semantic analysis and AST construction pending discussion is how to build AST for a function call.</p> <p>We start with an example. Suppose we have the following declarations:</p> <p>int Compute(int p, int q); int find(int x);</p> <p>A call to the function would occur as in:</p> <p>t = Compute(a+b,find(a-b));</p> <p>The statement is semantically valid provided a, b, and c integer type variables. Note that the call might occur in the code of <em>any function (including the same function – as in the case of a recursive call)</em>.</p> <p>The expression tree for this could look as below:</p> <p><img alt src=../../img/expression%20tree.png></p> <p>A tree node for a function call contains a pointer to a list of expressions, one expression for each argument. <strong>The compiler must type check each argument and match it with the type of the corresponding formal parameter of the called function.</strong></p> <p>To get an overall picture of what is going on, you may read the documentation on <a href=../../data-structures/ >compile time data structures</a> at this juncture. <strong>Ignore type table entries for now</strong> as we permit only integer/string variables in the present stage.</p> <p>The expression tree structure given <a href=../../data_structures/abstract-syntax-tree/ >HERE</a> can be used (again, ignore type table pointer) The details of implementation are left to you.</p> <p>With this information, the task of completing type checking and building expression tree for a function is straightforward.</p> <p><strong>Task 2</strong>: Construct AST for each function after checking type and scope rules (semantic analysis). Right now, we are concerned just with type and scope analysis and not code generation. Note that a variable appearing in a function must first be searched for in the local symbol table of the function and then in the global symbol table, if not found in the local symbol table. Note that local declaration overrides global declaration. The compiler must report an error if the types, names and number of arguments in each function declaration are not matching with the function definition.</p> <p>Now we turn to the code generation step.</p> <p>The dynamics of a function call can be understood easily by dividing the process into the following three stages.</p> <ul> <li>Step 1. <strong>Code executed in the calling function (caller) before the transfer of control</strong> to the called function (<strong>callee</strong>):<ul> <li>a) The caller must <strong>save the registers</strong> in use so that even if the callee changes the values later, the original values can be recovered after return from the callee.</li> <li>b) The caller must <strong>evaluate the arguments to the callee and store it</strong> somewhere in a way that the <strong>callee can access those values</strong>.</li> <li>c) The caller must create some <strong>space for the callee to place the return value</strong> at the end of the call.</li> <li>d) The caller must <strong>transfer control to the binding address of the callee</strong>.</li> </ul> </li> <li>Step 2. <strong>Actions executed by the called function (callee)</strong>:<ul> <li>a) The callee must <strong>allocate space for its local variables</strong>.</li> <li>b) Execute the callee code.</li> <li>c) When encountering a return instruction, the <strong>return value must be computed and stored</strong> in the appropriate place specified by the caller (step 1.c above).</li> <li>d) <strong>Return</strong> control to the caller.</li> </ul> </li> <li>Step 3. <strong>Actions executed by the caller</strong> after the callee returned control back to the caller.<ul> <li>a) <strong>Recover the return value</strong> stored by the callee.</li> <li>b) <strong>Deallocate space allocated for arguments</strong> for the call in step 1(b).</li> <li>c) <strong>Recover the machine registers</strong> stored before the call in step 1(a).</li> </ul> </li> </ul> <p>The machine code for actions in Step 1 and Step 3 must be generated when the compiler encounters a function call in the caller's code. The compiler generates code for Step 2 while generating code for the callee function.</p> <p>To implement the above plan, we need to create storage space whenever a function call is encountered. We will be focusing on generating code containing labels. Translation of labels to actual addresses can be easily done at the end as was done in Stage 4 following the <a href=../../label-translation/ >Label Translation Documentation</a>.</p> <p><strong>Implementation Strategy</strong>.</p> <p>The fundamental strategy for space allocation is to create an <strong>activation record</strong> for the callee in the <strong>stack</strong> when a function call is encountered. <strong>The compiler must generate code for creating the activation record at run-time when the call is encountered</strong>. Since the storage requirements for arguments, local variables and the return value of a function are known at compile time, the compiler knows exactly how much space must be allocated for each function. We propose following general organization for activation records:</p> <ul> <li>1. Each <strong>activation record must have a base (memory location)</strong> which is determined at run time. The machine register <strong>BP (base pointer)</strong> is generally used to point to the base of the activation record of the function executing currently.</li> <li>2. <strong>Relative to the base, the address of each argument, each local variable, the address where the return value is stored etc are fixed by the compiler statically</strong> (at compile time).</li> <li>3. Initially, the activation record for the main function is created in the stack. BP is initialized to the base of this activation record and the main function starts execution.</li> <li>4. <strong>If function A calls function B, a new activation record is created in the stack for function B above the activation record of function A</strong>. The BP is made to point to the base of activation record of B. Upon return from B, the activation record of B is popped off the stack and BP is set back to the activation record of A.</li> <li>5. If function A calls function B, the address of the instruction in A to resume execution (<strong>return address</strong> – value of current-IP +2 in XSM machine- why?) upon return from B must be saved. Similarly, the <strong>base pointer of the caller</strong> (BP value) of A <strong>must be saved in the stack</strong> before BP is changed to point to the base of B. Both the return address and BP values will be stored in pre-defined locations of the activation record of B.</li> <li>6. In addition to the above, one additional <strong>space</strong> must be reserved in the activation record of B <strong>to store the return value</strong>.</li> </ul> <p>A thorough reading of this <a href=../../run_data_structures/run-time-stack/ >page</a> is <strong>absolutely essential</strong> to proceed any further. Suppose a function has n arguments (arg_1, arg_2,...,arg_n) and m local variables (loc_1, loc_2, ..., loc_m), its activation record in the stack may look as the following.(The stack is assumed to grow downwards.)</p> <p><img alt src=../../img/stack.png></p> <p>In this scheme, the following code must be generated by the caller when a call to the above function is encountered:</p> <ul> <li>1. Generate code to <strong>push registers</strong> in use into the stack. After this, the callee's activation record begins.</li> <li>2. Evaluate arg_n and push the value to the stack. Now evaluate and push arg_n-1 and so on till arg_1. The <strong>arguments are pushed in reverse order</strong>. (You can do it in any order as long as the same convention is followed everywhere).</li> <li>3. <strong>Push one empty space</strong> in the stack for the callee to store the <strong>return value</strong>.</li> <li>4. Generate <strong>Call instruction</strong> to the binding (label) of the function. (The call instruction will push IP+2 into the stack and jump to label.)</li> </ul> <p>Stack before the call instruction :</p> <p><img alt src=../../img/before%20call.png></p> <p>Stack after the call instruction :</p> <p><img alt src=../../img/after%20call.png></p> <p>Figure: Actions in the stack done by the caller before the call</p> <p><strong>Once the call is made, the next instruction in the caller will be executed only after the callee executes a return statement</strong>. The caller must proceed from here assuming that <strong>the callee would have placed the return value</strong> in the location in the stack designated for it. The caller must generate code to extract the return value and clean up the stack.</p> <ul> <li>5. Allocate a new register and <strong>store the returned value</strong> into the register.</li> <li>6. <strong>Pop out arguments</strong> from the stack. (The arguments may be discarded now.)</li> <li>7. <strong>Restore registers</strong> saved in the stack in step 1.</li> </ul> <p>The above actions are sufficient to generate code for handling a function invocation. Note that to generate code for a call, only the callee's declaration information (argument information and call label) needs to be known. All that the caller needs to know is the callee's <strong>interface</strong>, and the <strong>calling convention</strong> (convention regarding in what order arguments must be pushed, where should the return value be stored etc. See also <a href=https://en.wikipedia.org/wiki/Calling_convention>link</a>).</p> <p>Now, we turn to the actions to be done by the callee. The callee must generate the following code before proceeding to the remaining instructions:</p> <ul> <li>1.<strong>Save the BP of the caller</strong> by pushing the BP register into the stack.</li> <li>2.<strong>Set BP</strong> to the present value of SP register.</li> <li>3. Push enough space in the stack for storing the local variables.</li> </ul> <p>Relative to the BP value set in step 2 above, [BP-2] is the address to which the return value must be stored. [BP-3] stores arg_1, [BP-4] stores arg_2 and so on. [BP+1] is for loc_1, [BP+2] for loc_2 and so on. Thus, after seeing the local variable declarations, the compiler can set the binding values for local variables relative to the base of activation record (BP) value as:</p> <p><img alt src=../../img/var-bind%20table.png></p> <p>With this convention, the code for each instruction inside a function can be generated following the rule: <strong>local variables/arguments are to be dereferenced a by adding the binding value to the contents of the BP register</strong>. Almost every modern architecture supports function calls by providing an explicit base pointer register.</p> <p>Finally, the code for a return statement must:</p> <ol> <li><strong>Pop out the local variables</strong> from the stack.</li> <li>Calculate the return expression and store the value in [BP-2].</li> <li><strong>set BP to the old value</strong> of BP in the stack.</li> <li><strong>Execute the RET instruction</strong> to pass control back to the caller.</li> </ol> <p>In the calling convention which we described above, the arguments were pushed in reverse order, space for the return value was allocated by the caller, BP of the caller was saved to the stack by the callee, and so on. Space created in the stack by either the callee or the caller must be eventually reclaimed by the same party.</p> <div class="admonition tip"> <p class=admonition-title>IMPORTANT NOTE</p> <p>In our calling convention, the caller was required to save the registers in use before the call. What if instead, we design a calling convention where the callee had to push the registers in use? The problem here is that the callee does not know (and does not have to know) the caller and hence do not know at each call which were the registers in use. Hence, the callee will have to save all machine registers, wasting time and space. Hence, the convention of the caller storing registers in use is superior. However, there are situations where this is not possible. For instance, in hardware interrupt routines, control is transferred to the callee without the caller executing a call. In such cases, the callee will have to save (all) the machine registers for a successful return.</p> </div> <p>You have enough background now to complete the final task of this stage.</p> <div class="admonition question"> <p class=admonition-title>Task 3</p> <p>Complete code generation for functional calls.</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 1</p> <p>Modify the function semantics to permit pointer type variables of <a href=../stage-04/#ex2>Stage 4 (Exercise 2)</a> to be passed as arguments to functions. This will allow a function to pass the address of a local variable to another function as an argument so that the callee can modify the contents. Modify the syntax and semantics rules appropriately. This feature must allow you to write functions like:</p> <p><code>int swap(int *p, int *q)</code></p> <p>Note that functions need to be permitted to return pointer type variables. (Returning a pointer to local variable from a function is not advisable – Why?).</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 2</p> <p><em>Hard work, but insightful</em></p> <p>Suppose you want to extend the language with facility of <strong>tuples</strong>. By a tuple, we mean an object declared as below:</p> <div class=highlight><pre><span></span><code>decl
..
..
 tuple tnme(type fname\_1, type fname\_2, .... ,type fname\_n) var\_1, var\_2 .. var\_k;
..
..
enddecl
</code></pre></div> <p>Note that tuple is introduced as a new keyword. For example, we could have:</p> <div class=highlight><pre><span></span><code>decl

 tuple student (str name, int roll\_no, str branchname, int year\_of\_admission) a, b, c, \*sptr;
 tuple faculty (str name, int employee\_id, str dept) x, y, z, \*fptr;

enddecl
</code></pre></div> <p>To access a tuple you must introduce the "." operator. Here is an example:</p> <div class=highlight><pre><span></span><code>read(a.name);
read(x.name);
if (a.name == x.name) then
 write(&quot;They have same names&quot;);
endif;
</code></pre></div> <p>You must also permit assignment of a tuple type variable to another, provided the variables are of the same tuple type.</p> <p>Design the syntax and semantics rules, make necessary modifications to the lexer, parser, symbol table and AST structures to incorporate the addition of tuples and change the code generation module accordingly. For now, assume that tuples cannot be passed as arguments to functions or be returned by functions. However, you must permit local tuple declarations. Note that you have considerable freedom in deciding on the grammar rules and data structures, and even the features permitted.</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 3</p> <p><em>Hard work, optional, but insightful. Can be done only after Exercise 1 and Exercise 2 are completed</em></p> <p>Allow tuples and pointers to tuples to be passed as arguments to functions. (Allowing the whole tuple to be passed creates more work in parameter passing, though not difficult in principle). Functions may be permitted to return tuples as return values. Permit a function that takes an argument/returns a tuple or pointers to tuple type to be declared only after the declaration of the concerned tuples (this is to avoid the <a href=https://en.wikipedia.org/wiki/Forward_declaration>forward reference problem</a>). Design syntax, semantics and code generation strategies appropriately.</p> </div> <h2 id=test-programs>Test Programs<a class=headerlink href=#test-programs title="Permanent link">&para;</a></h2> <p>Check your implementation with the following test cases :</p> <ul> <li><a href=../../testprograms/test-program-03/ >Test Program 1 : Bubblesort (recursive)</a></li> <li><a href=../../testprograms/test-program-05/ >Test Program 2 : Factorial (recursive)</a></li> <li><a href=../../testprograms/test-program-06/ >Test Program 3 : Quicksort (recursive)</a></li> <li><a href=../../testprograms/test-program-07/ >Test Program 4 : Constant Program (recursive)</a></li> <li><a href=../../testprograms/test-program-10/ >Test Program 5 : Fibonacci (recursive)</a></li> <li><a href=../../testprograms/test-program-02/ >Test Program 6 : Extended Euclid(with a Function)</a></li> <li><a href=../../testprograms/test-program-01/ >Test Program 7 : BubbleSort (iterative)</a></li> <li><a href=../../testprograms/test-program-12/ >Test Program 8 : Extended Euclid(iterative)</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=https://creativecommons.org/licenses/by-nc/4.0/ rel=license> <img alt="Creative Commons License" style=border-width:0 src=https://licensebuttons.net/l/by-nc/4.0/80x15.png> </a> National Insititute of Technology, Calicut </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/silcnitc target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://groups.google.com/g/expl-users target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 488 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.top", "navigation.sections"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.fe8b6f2b.min.js></script> </body> </html>