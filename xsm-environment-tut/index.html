<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Compiler Lab website for NIT Calicut"><link href=https://silcnitc.github.io/expl-docs/xsm-environment-tut/ rel=canonical><link href=../xsmusagespec/ rel=prev><link href=../library-implementation/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.31"><title>XSM EXECUTION ENVIRONMENT TUTORIAL - EXPL NIT-C</title><link rel=stylesheet href=../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=purple data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#xsm-execution-environment-tutorial class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <b>Site is undergoing migration.</b> Old URL: <a href=https://silcnitc.github.io target=_blank target=_blank rel="nofollow noopener">https://silcnitc.github.io</a> </div> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="EXPL NIT-C" class="md-header__button md-logo" aria-label="EXPL NIT-C" data-md-component=logo> <img src=../img/nitc-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> EXPL NIT-C </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> XSM EXECUTION ENVIRONMENT TUTORIAL </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=purple data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=purple data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../about/philosophy/ class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../roadmap/ class=md-tabs__link> Roadmap </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../documentation/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=../feedback/ class=md-tabs__link> Student Feedback </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="EXPL NIT-C" class="md-nav__button md-logo" aria-label="EXPL NIT-C" data-md-component=logo> <img src=../img/nitc-logo.png alt=logo> </a> EXPL NIT-C </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> About </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../about/philosophy/ class=md-nav__link> <span class=md-ellipsis> Philosophy </span> </a> </li> <li class=md-nav__item> <a href=../about/authors/ class=md-nav__link> <span class=md-ellipsis> Authors </span> </a> </li> <li class=md-nav__item> <a href=../about/license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Roadmap </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Roadmap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../roadmap/ class=md-nav__link> <span class=md-ellipsis> Roadmap </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-00/ class=md-nav__link> <span class=md-ellipsis> Stage 0 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-01/ class=md-nav__link> <span class=md-ellipsis> Stage 1 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-02/ class=md-nav__link> <span class=md-ellipsis> Stage 2 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-03/ class=md-nav__link> <span class=md-ellipsis> Stage 3 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-04/ class=md-nav__link> <span class=md-ellipsis> Stage 4 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-05/ class=md-nav__link> <span class=md-ellipsis> Stage 5 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-06/ class=md-nav__link> <span class=md-ellipsis> Stage 6 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-07/ class=md-nav__link> <span class=md-ellipsis> Stage 7 </span> </a> </li> <li class=md-nav__item> <a href=../roadmap/stage-08/ class=md-nav__link> <span class=md-ellipsis> Stage 8 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../codegen/ class=md-nav__link> <span class=md-ellipsis> Code Generation </span> </a> </li> <li class=md-nav__item> <a href=../abi/ class=md-nav__link> <span class=md-ellipsis> Application Binary Interface </span> </a> </li> <li class=md-nav__item> <a href=../libinterface/ class=md-nav__link> <span class=md-ellipsis> Library Implementation </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex> <span class=md-ellipsis> ExPL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> ExPL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../expl/ class=md-nav__link> <span class=md-ellipsis> ExpL Specification </span> </a> </li> <li class=md-nav__item> <a href=../grammar-outline/ class=md-nav__link> <span class=md-ellipsis> ExpL Grammar Outline </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_3> <label class=md-nav__link for=__nav_4_5_3 id=__nav_4_5_3_label tabindex=0> <span class=md-ellipsis> Compile Time Data Structures for ExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_3> <span class="md-nav__icon md-icon"></span> Compile Time Data Structures for ExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../data-structures/ class=md-nav__link> <span class=md-ellipsis> Compile Time Data Structures for ExpL </span> </a> </li> <li class=md-nav__item> <a href=../data_structures/abstract-syntax-tree/ class=md-nav__link> <span class=md-ellipsis> Abstract Syntax Tree </span> </a> </li> <li class=md-nav__item> <a href=../data_structures/type-table/ class=md-nav__link> <span class=md-ellipsis> Type Table </span> </a> </li> <li class=md-nav__item> <a href=../data_structures/global-symbol-table/ class=md-nav__link> <span class=md-ellipsis> Global Symbol Table </span> </a> </li> <li class=md-nav__item> <a href=../data_structures/local-symbol-table/ class=md-nav__link> <span class=md-ellipsis> Local Symbol Table </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_4> <label class=md-nav__link for=__nav_4_5_4 id=__nav_4_5_4_label tabindex=0> <span class=md-ellipsis> Run Time Data Structures for ExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_4> <span class="md-nav__icon md-icon"></span> Run Time Data Structures for ExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../run-data-structures/ class=md-nav__link> <span class=md-ellipsis> Run Time Data Structures for ExpL </span> </a> </li> <li class=md-nav__item> <a href=../run_data_structures/heap/ class=md-nav__link> <span class=md-ellipsis> Heap Allocation </span> </a> </li> <li class=md-nav__item> <a href=../run_data_structures/register/ class=md-nav__link> <span class=md-ellipsis> Register Allocation </span> </a> </li> <li class=md-nav__item> <a href=../run_data_structures/run-time-stack/ class=md-nav__link> <span class=md-ellipsis> Stack Allocation </span> </a> </li> <li class=md-nav__item> <a href=../run_data_structures/static-allocation/ class=md-nav__link> <span class=md-ellipsis> Static Allocation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_5> <label class=md-nav__link for=__nav_4_5_5 id=__nav_4_5_5_label tabindex=0> <span class=md-ellipsis> ExPL Test Programs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_5_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_5> <span class="md-nav__icon md-icon"></span> ExPL Test Programs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../testprograms/ class=md-nav__link> <span class=md-ellipsis> Test Programs </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-01/ class=md-nav__link> <span class=md-ellipsis> Program 1 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-02/ class=md-nav__link> <span class=md-ellipsis> Program 2 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-03/ class=md-nav__link> <span class=md-ellipsis> Program 3 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-04/ class=md-nav__link> <span class=md-ellipsis> Program 4 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-05/ class=md-nav__link> <span class=md-ellipsis> Program 5 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-06/ class=md-nav__link> <span class=md-ellipsis> Program 6 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-07/ class=md-nav__link> <span class=md-ellipsis> Program 7 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-08/ class=md-nav__link> <span class=md-ellipsis> Program 8 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-09/ class=md-nav__link> <span class=md-ellipsis> Program 9 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-10/ class=md-nav__link> <span class=md-ellipsis> Program 10 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-11/ class=md-nav__link> <span class=md-ellipsis> Program 11 </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/test-program-12/ class=md-nav__link> <span class=md-ellipsis> Program 12 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5_5_14> <label class=md-nav__link for=__nav_4_5_5_14 id=__nav_4_5_5_14_label tabindex=0> <span class=md-ellipsis> Stage 4 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_4_5_5_14_label aria-expanded=false> <label class=md-nav__title for=__nav_4_5_5_14> <span class="md-nav__icon md-icon"></span> Stage 4 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../testprograms/stage4/bubblesort/ class=md-nav__link> <span class=md-ellipsis> Bubble Sort </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/stage4/fibaofn/ class=md-nav__link> <span class=md-ellipsis> Fibonacci </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/stage4/prime/ class=md-nav__link> <span class=md-ellipsis> Prime </span> </a> </li> <li class=md-nav__item> <a href=../testprograms/stage4/sum-to-n-fact/ class=md-nav__link> <span class=md-ellipsis> Sum to n! </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex> <span class=md-ellipsis> OExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> OExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../oexpl-specification/ class=md-nav__link> <span class=md-ellipsis> OExpL Specification </span> </a> </li> <li class=md-nav__item> <a href=../oexpl-grammar-outline/ class=md-nav__link> <span class=md-ellipsis> OExpL Grammar Outline </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6_3> <label class=md-nav__link for=__nav_4_6_3 id=__nav_4_6_3_label tabindex=0> <span class=md-ellipsis> Compile Time Data Structures for OExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6_3> <span class="md-nav__icon md-icon"></span> Compile Time Data Structures for OExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../oexpl-data-structures/ class=md-nav__link> <span class=md-ellipsis> Compile Time Data Structures for OExpL </span> </a> </li> <li class=md-nav__item> <a href=../oexpl_data_structures/class-table/ class=md-nav__link> <span class=md-ellipsis> Class Table </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6_4> <label class=md-nav__link for=__nav_4_6_4 id=__nav_4_6_4_label tabindex=0> <span class=md-ellipsis> Run Time Data Structures for OExpL </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_6_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6_4> <span class="md-nav__icon md-icon"></span> Run Time Data Structures for OExpL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../oexpl-run-data-structures/ class=md-nav__link> <span class=md-ellipsis> Run Time Data Structures for OExpL </span> </a> </li> <li class=md-nav__item> <a href=../oexpl_runtime_data_structures/virtual_function_table/ class=md-nav__link> <span class=md-ellipsis> Virtual Function Table </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../oexpl-runtime-binding-tutorial/ class=md-nav__link> <span class=md-ellipsis> OExPL Runtime Binding </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_6_6> <label class=md-nav__link for=__nav_4_6_6 id=__nav_4_6_6_label tabindex=0> <span class=md-ellipsis> OExPL Test Programs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_6_6_label aria-expanded=false> <label class=md-nav__title for=__nav_4_6_6> <span class="md-nav__icon md-icon"></span> OExPL Test Programs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../oexpl-testprograms/ class=md-nav__link> <span class=md-ellipsis> OExPL Test Programs </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test1/ class=md-nav__link> <span class=md-ellipsis> Program 1 </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test2/ class=md-nav__link> <span class=md-ellipsis> Program 2 </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test3/ class=md-nav__link> <span class=md-ellipsis> Program 3 </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test4/ class=md-nav__link> <span class=md-ellipsis> Program 4 </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test5/ class=md-nav__link> <span class=md-ellipsis> Program 5 </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test6/ class=md-nav__link> <span class=md-ellipsis> Program 6 </span> </a> </li> <li class=md-nav__item> <a href=../oexpltestprograms/test7/ class=md-nav__link> <span class=md-ellipsis> Program 7 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7 checked> <label class=md-nav__link for=__nav_4_7 id=__nav_4_7_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_7_label aria-expanded=true> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../lex/ class=md-nav__link> <span class=md-ellipsis> Using LEX </span> </a> </li> <li class=md-nav__item> <a href=../yacc/ class=md-nav__link> <span class=md-ellipsis> Using YACC </span> </a> </li> <li class=md-nav__item> <a href=../ywl/ class=md-nav__link> <span class=md-ellipsis> Using YACC with LEX </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_7_4> <label class=md-nav__link for=__nav_4_7_4 id=__nav_4_7_4_label tabindex=0> <span class=md-ellipsis> GDB </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_7_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_7_4> <span class="md-nav__icon md-icon"></span> GDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../gdb/ class=md-nav__link> <span class=md-ellipsis> Using GDB </span> </a> </li> <li class=md-nav__item> <a href=../gdb-files/ class=md-nav__link> <span class=md-ellipsis> GDB Input Files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../label-translation/ class=md-nav__link> <span class=md-ellipsis> Label Translation </span> </a> </li> <li class=md-nav__item> <a href=../install/ class=md-nav__link> <span class=md-ellipsis> XSM Simulator Installation </span> </a> </li> <li class=md-nav__item> <a href=../xsmusagespec/ class=md-nav__link> <span class=md-ellipsis> XSM Simulator Instructions </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> XSM Environment Tutorial </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> XSM Environment Tutorial </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#experiment-i-adding-two-numbers-using-registers class=md-nav__link> <span class=md-ellipsis> Experiment I : Adding two numbers using registers </span> </a> <nav class=md-nav aria-label="Experiment I : Adding two numbers using registers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experiment-ii-inputoutput-using-os-system-call-interface class=md-nav__link> <span class=md-ellipsis> Experiment II : Input/Output using OS system call interface </span> </a> <nav class=md-nav aria-label="Experiment II : Input/Output using OS system call interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation_1 class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experiment-iii-understanding-the-library-interface class=md-nav__link> <span class=md-ellipsis> Experiment III: Understanding the Library Interface </span> </a> <nav class=md-nav aria-label="Experiment III: Understanding the Library Interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation_2 class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../library-implementation/ class=md-nav__link> <span class=md-ellipsis> Library Implementation </span> </a> </li> <li class=md-nav__item> <a href=../attribute/ class=md-nav__link> <span class=md-ellipsis> Attribute Synthesis </span> </a> </li> <li class=md-nav__item> <a href=../Data_Structures/ class=md-nav__link> <span class=md-ellipsis> Data Structures for ExpL Compilation/Interpretation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 id=__nav_4_8_label tabindex> <span class=md-ellipsis> Misc </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_8_label aria-expanded=false> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ex1/ class=md-nav__link> <span class=md-ellipsis> Exercise 1 </span> </a> </li> <li class=md-nav__item> <a href=../explusagespec/ class=md-nav__link> <span class=md-ellipsis> ExPL Usage spec? </span> </a> </li> <li class=md-nav__item> <a href=../libinterfaceexpl/ class=md-nav__link> <span class=md-ellipsis> ExPL Library Interface? </span> </a> </li> <li class=md-nav__item> <a href=../help/ class=md-nav__link> <span class=md-ellipsis> help </span> </a> </li> <li class=md-nav__item> <a href=../oexpl/ class=md-nav__link> <span class=md-ellipsis> OExPL </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Student Feedback </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Student Feedback </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../feedback/ class=md-nav__link> <span class=md-ellipsis> Student Feedback </span> </a> </li> <li class=md-nav__item> <a href=../feedback/nitc-winter-2021/ class=md-nav__link> <span class=md-ellipsis> NIT-C Winter 2021 </span> </a> </li> <li class=md-nav__item> <a href=../feedback/nitc-winter-2017/ class=md-nav__link> <span class=md-ellipsis> NIT-C Winter 2017 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#experiment-i-adding-two-numbers-using-registers class=md-nav__link> <span class=md-ellipsis> Experiment I : Adding two numbers using registers </span> </a> <nav class=md-nav aria-label="Experiment I : Adding two numbers using registers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experiment-ii-inputoutput-using-os-system-call-interface class=md-nav__link> <span class=md-ellipsis> Experiment II : Input/Output using OS system call interface </span> </a> <nav class=md-nav aria-label="Experiment II : Input/Output using OS system call interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation_1 class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#experiment-iii-understanding-the-library-interface class=md-nav__link> <span class=md-ellipsis> Experiment III: Understanding the Library Interface </span> </a> <nav class=md-nav aria-label="Experiment III: Understanding the Library Interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation_2 class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=xsm-execution-environment-tutorial>XSM EXECUTION ENVIRONMENT TUTORIAL<a class=headerlink href=#xsm-execution-environment-tutorial title="Permanent link">&para;</a></h1> <div class="admonition abstract"> <p class=admonition-title>Prerequisites</p> <p>A quick reading of the ExpOS <a href=../abi/ >ABI documentation</a> for XSM machine. You may not understand the whole content now. The details will be explained as you read ahead.</p> </div> <div class="admonition example"> <p class=admonition-title>Learning Objectives</p> <p>At the end of this tutorial you will be able to <strong>generate XEXE executable files</strong> containing XSM assembly language programs which can be run on the XSM simulator given to you. Along the way, you will learn how to use the <strong>system call interface</strong> and the <strong>library interface</strong> of the underlying Operating system to handle console input and output.</p> </div> <p>This tutorial helps you to gain a basic understanding of the execution environment provided by the XSM simulator. The compiler you design for the ExpL language is supposed to generate target XSM machine code that runs on the XSM Simulator provided to you. However, the bare machine cannot directly run the target code. The operating system (OS) that runs on top of the machine is the actual software that sets up an execution enviornment necessary for running the target code. Hence, the compiler's obligation is to generate target code that is understandable to the operating system.</p> <p>Consequently, there must be a document provided by the OS implementation to the compiler designer that explains the interface to the operating system that the compiler must adhere to. This document is called the <strong>Application Binary Interface</strong> or <strong>ABI</strong>.</p> <p>The XSM simulator given to you is actually much more than a bare XSM hardware simulator. It has the capacity to understand the ABI for the ExpOS operating System for the XSM machine. This ABI expects that the compiler generates the target file in a format called the <a href=../abi/#nav-XEXE-executable-file-format>XEXE executable format</a>.</p> <p>Your compiler simply needs to generate an executable file following the XEXE executable format and store it on the local machine. When you use the XSM simulator to run the program, the following actions take place.</p> <ul> <li>1. The script that runs the simulator transfers the file from your local machine's disk to the XSM machine's (simulated) hard disk.</li> <li>2. It then boots up the operating system (the OS is already preloaded in the simulator's hard disk). The bootstrap loader starts in the kernel mode and sets up a user process in memory, allocating an address space. Then, it transfers the executable file from the hard disk to the <a href=../abi/#nav-virtual-address-space-model>code region</a> of this memory. Page tables are also set up to run the process in user mode.</li> <li>3. Finally, the simulator sets the instruction pointer (IP) to the address specified in the <strong>entry-point field</strong> of the header of the executable file and control transfers to this instruction, resulting in execution of the loaded program starting with the instruction specified by the entry point. The machine also switches from the kernel mode to the user mode. (Technically, the OS code pushes the entry point address on to the program's stack and executes the <a href=https://exposnitc.github.io/expos-docs/arch-spec/instruction-set/ >IRET instruction</a> resulting in transfer of control in user mode to the specified memory address. These details are not relevant for your work and are noted just for the sake of information.)</li> </ul> <p>We start now by generating a small XEXE executable file containing an XSM program to find the sum of two numbers and store the value in a register. The value of the register will have to be inspected in order to view the ouput. This is possible by executing the XSM simulator in <a href=../xsmusagespec/#nav-debug>debug mode</a>. Later we will see how console input and output are handled.</p> <hr> <h2 id=experiment-i-adding-two-numbers-using-registers><strong>Experiment I</strong> : Adding two numbers using registers<a class=headerlink href=#experiment-i-adding-two-numbers-using-registers title="Permanent link">&para;</a></h2> <p>As noted above, executable programs must be designed in such a way that it must be possible for the file to be loaded and executed by the underlying operating system. When a program is loaded into memory by the OS, the OS typically assigns a virtual address space (or simply an address space). In the present case, the address space of a program starts at address 0 of the memory and ends at address 5119. This means that while designing the target program, you may assume that this is the total computer memory accessible to the program.</p> <p>The compiler typically divides this memory into various regions – namely the code region, (often called the text region), data region, stack region, heap region etc. The ABI specifies the starting address and ending address of each region in the address space. This is specified <a href=../abi/#nav-virtual-address-space-model>HERE</a>. The ABI specifies that the compiler must divide the memory into four regions – <strong>library, code, stack and heap</strong>. (there is <strong>no separate data region</strong> – instead the stack region must be used for this as well).</p> <p>For our immediete requirements, the important region is the code region. The code region contains two parts – a <strong>header</strong> (addresses 2048 to 2055) and <strong>code</strong> (address 2056-4095). The target code will be loaded into this region of the memory when the OS (simulator) loads the program for execution. Details will be described soon.</p> <p>The XEXE executable format stipulates that the <strong>first 8 words of an executable file must be a header</strong>. The rest of the file must contain assembly language program to be executed. The loader actually will simply copy the contents of the executable file into the region of memory between addresses 2048 and 4095. Consequently, the header will be loaded between 2048-2055 and the rest of the file (containing the XSM instructions) into addresses 2056 to 4095. The contents of the file will be copied to the memory in the order in which they appear in the file.</p> <p>Since each XSM assembly instruction requires two words of memory storage, the first instruction will be loaded into address 2056 and 2057, the second in 2058 and 2059 and so forth. Since the code region of the memory ends at 4095, the maximum number of instructions possible in a program is limited to 1020. This is the limit set by the particular OS platform used in this experiment.</p> <p>One important field of the header is its second entry – the entry point. The loader initializes the <strong>Instruction Pointer (IP)</strong> register of the XSM machine to this value. Thus, if entry point is 2064, the simulator the XSM machine simulator will start program execution by fetching the instruction stored at this address. The ABI stipulates that the value of the first field called the <strong>magic number</strong> must be set to zero. The setting of other fields in the header are not relevant for this experiment.</p> <p><strong>Note</strong>: When the program is actually loaded for execution by the OS, the physical addresses in the actual memory to which the executable program is loaded will be different from the virtual addresses set by the compiler. Such relocation requires architecture support. In the XSM machine, the support is through paging. However address translation is a concern of the OS, not of the compiler. Hence we will not pursue this matter here. However, for those interested, details on XSM paging scheme is given <a href=https://exposnitc.github.io/expos-docs/arch-spec/paging-hardware/ >HERE</a>.</p> <p>With this, we complete the background needed to complete the present experiment. We now proceed to the implementation.</p> <h3 id=implementation>Implementation<a class=headerlink href=#implementation title="Permanent link">&para;</a></h3> <p>An XSM assembly language program to find the sum of two numbers could work as the following:</p> <div class=highlight><pre><span></span><code>1. Store the first number in a register – say R0.
2. Store the second number in a register – say R1.
3. ADD R0, R1.
</code></pre></div> <p>The result will be stored in R0. To generate code for the above tasks and write it into a target_file, you must write code as:</p> <div class=highlight><pre><span></span><code><span class=n>fprintf</span><span class=p>(</span><span class=n>target_file</span><span class=p>,</span><span class=w> </span><span class=s>&quot;BRKP&quot;</span><span class=p>);</span>
<span class=n>fprintf</span><span class=p>(</span><span class=n>target_file</span><span class=p>,</span><span class=w> </span><span class=s>&quot;MOV R0, 3</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=n>fprintf</span><span class=p>(</span><span class=n>target_file</span><span class=p>,</span><span class=w> </span><span class=s>&quot;MOV R1, 2</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
<span class=n>fprintf</span><span class=p>(</span><span class=n>target_file</span><span class=p>,</span><span class=w> </span><span class=s>&quot;ADD R0, R1</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>);</span>
</code></pre></div> <p>The <code>target_file</code> will look as shown below.</p> <div class=highlight><pre><span></span><code><span class=nf>BRKP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=mi>3</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=no>R1</span>
</code></pre></div> <p>However, the header must be written into the first eight words of the target file before writing out the instructions. You must reserve the first eight words of the executable file for the header before writing code into the file. Now, set the entry point field to the first instruction to be executed. If the code is written immedietely after the header, the first instruction will be loaded to memory address 2056 and 2057 (see <a href=../abi/#nav-virtual-address-space-model>memory model</a>). Hence, you must set the header as:</p> <div class=highlight><pre><span></span><code><span class=n>fprintf</span><span class=p>(</span><span class=n>target_file</span><span class=p>,</span><span class=w> </span><span class=s>&quot; %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> %d</span><span class=se>\n</span><span class=s> &quot;</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>2056</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</code></pre></div> <p><code>target_file</code> after adding header</p> <div class=highlight><pre><span></span><code><span class=err>0</span>
<span class=err>2056</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=nf>BRKP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=mi>3</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=no>R1</span>
</code></pre></div> <p>The above code essentially sets the first field – magic number - to 0, the second field - entry point - to 2056 and other fields to 0.</p> <p>Now, to run the executable file, you must use the XSM simulator. The simulator usage commands are specified <a href=../xsmusagespec/ >here</a>. You must read the above link before proceeding further.</p> <p>The simulator expects a library file by the name library.lib together with the XEXE executable file to be supplied as a command line argument. You will learn more about the library in later in this documentation. For now create a file library.lib with just one instruction in the XSM simulator folder.</p> <div class=highlight><pre><span></span><code><span class=nf>RET</span>
</code></pre></div> <p>Now we will try to execute the target_file in the <a href=../xsmusagespec/#nav-debug>debug mode</a>.</p> <ol> <li>Open terminal and navigate to the simulator folder.</li> <li>Type <code>./xsm -l library.lib -e &lt;path to target_file.xsm&gt; --debug</code>.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Path to the xsm file need to be relative path.</p> </div> <p>Since we are trying to execute the <code>target_file</code> in debug mode, the simulator executes all the instructions present before the <code>BRKP</code> instruction. We will look at the status of register R0 before the execution of instruction <code>MOV R0, 3</code>.</p> <p><img alt src=../img/reg0before.png></p> <p>Type <code>s</code> and then type <code>reg R0</code>.</p> <p><img alt src=../img/reg0after.png></p> <p>We can see that value 3 is stored in this register. Now try typing <code>s</code> and then <code>reg R1</code>.</p> <p><img alt src=../img/reg1.png></p> <p>Type <code>s</code> and then type <code>reg R0</code>.</p> <p><img alt src=../img/regR05.png></p> <p>We can see that value stored in the register is 5. Now type <code>reg R0 R1</code></p> <p><img alt src=../img/regR0R1.png></p> <p>The command <code>reg Rn Rm</code> dislays the contents of all registers from <code>n</code> to <code>m</code>.</p> <p>Now type <code>reg</code>.</p> <p><img alt src=../img/reg.png></p> <p>This command displays the contents of all the machine registers namely IP, SP, BP, PTBR, PTLR, EIP, EC, EPN, EMA, R0-R19 in that order. We will not be concerned with PTBR, PTLR, EIP, EC, EPN and EMA registers which are accessible only to the OS kernel executing in previliged mode. Note that the value of IP register is 2064. IP was initialized to 2056 while loading (entry point value) and after executing four instructions, IP got incremented to 2064. The OS kernel had set SP to point 4095 at load time (why?).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>You would have observed that if you try to continue to execute beyond the last instruction, the simulator flags abnormal program termination. This is because after executing the last instruction of the program, the simulator increments the instruction pointer and tries to execute the next instruction. However, since there is no valid instruction stored in the memory, the simulator will enconter an invalid instruction and generate an exception. This results in transfer of program control to the OS kernel code that will terminate execution and report error. We will see how graceful program termination is achieved in the next experiment.</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 1</p> <p>Write an XSM assembly langauge program to find the largest of three numbers and run it on the simulator. You will learn how to handle the JMP instruction while doing this exercise.</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 2</p> <p>Modify your code generation module to store the result of the previous program in the first location in <a href=../abi/#nav-virtual-address-space-model>stack region</a> namely address 4096 and watch the contents in debug mode after execution.</p> </div> <h2 id=experiment-ii-inputoutput-using-os-system-call-interface><strong>Experiment II</strong> : Input/Output using OS system call interface<a class=headerlink href=#experiment-ii-inputoutput-using-os-system-call-interface title="Permanent link">&para;</a></h2> <div class="admonition abstract"> <p class=admonition-title>Reading Assignment</p> <p>Read the low level system call interface of the <a href=../abi/#nav-lowlevel-syscall-interface>ABI</a></p> </div> <p>In this experiment, you will extend the previous stage to print the result of adding two numbers to the console using the low level system call interface provided by the ABI.</p> <p>The conceptual point to understand here is that console I/O is handled by the kernel routines of the operating system. Kernel modules execute in <strong>privileged mode</strong> of execution and can execute special privileged instructions that access devices and other resources in a machine.</p> <p>However, your XEXE executable program execute in unprivileged mode. Such programs are called <strong>application programs</strong> or simply applications. These programs cannot contain privileged instructions. (If you try to write privileged instruction in your program and execute, the machine will raise an <strong>exception</strong> when it fetches the instruction and the exception handler module of the OS kernel will terminate the application, flagging an error.) The <a href=../abi/#nav-XSM-instruction-set>instructions</a> specified in the ABI given to you are all unprivileged instructions. (To know more about privileged instructions in XSM, see <a href=https://exposnitc.github.io/expos-docs/arch-spec/instruction-set/#privileged-instructions>ExPOS documentation</a>).</p> <p>An OS typically provides you with a set of kernel level routines called system calls which your code can invoke for performing console I/O. A system call is invoked by a trap instruction (The INT instruction is the trap instruction of the XSM machine). Arguments like the system call number specifying the particular OS service (like read/write/program exit) and so on are required. (see details <a href=../abi/#syscalltable>here</a>). The OS specifies how an application must pass arguments and extract return values from system calls called the calling conventions. <strong>Generally, arguments to a system call are passed through the application program's stack</strong>. These details are written down in the <a href=../abi/#nav-lowlevel-syscall-interface>low level system call interface</a> of the ABI.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>An OS typically will provide a large number of system calls for various requirements. For our purposes, the relevant system calls are those for console read, console write and program exit.</p> </div> <p>As noted previously, the arguments/return values to/from a system call are passed through the application program's stack. Each application maintains a stack region in memory where run-time data can be stored while the program executes. The ABI specification stipulates that the stack region of a program shall be between memory addresses 4096 and 5119. The application generally reserves some initial addresses starting from 4096 for storing global variables in the program (called <strong>static allocation</strong>) and then initializes the stack to the first free memory after those allocated to variables. Arguments to a system call are pushed into the stack before executing the INT instruction. Before the system call transfer control back (using the <a href=https://exposnitc.github.io/expos-docs/arch-spec/instruction-set/ >IRET instruction</a>), return values would have been pushed into the stack.</p> <h3 id=implementation_1>Implementation<a class=headerlink href=#implementation_1 title="Permanent link">&para;</a></h3> <p>In Experiment I above, you were asked to calculate the sum of two numbers which are stored in registers. Now, we will see how this number can be printed out into the console.</p> <p>To print the data into the console, we need to:</p> <ol> <li>Push the data(using registers) into the stack along with other arguments to the system call.</li> <li>Invoke the write system call using the INT instruction specifying the appropriate interrupt number.</li> </ol> <p>To use the stack we need to set the stack pointer(SP). Always SP should point the top value of the stack. The XSM machine increments SP immedietely before a PUSH operation by XSM machine and hence the first PUSH operation will be storing data to address 4096. So, we need to initialize SP to 4095.</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>SP</span><span class=p>,</span><span class=w> </span><span class=mi>4095</span>
</code></pre></div> <p>Now, the arguments to a write operation must be pushed on to the stack: Note that the contents which are to be written to the console are present in the register R0. So, we are not using the register R0. <strong>System Call Number</strong> : 5 for Write</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>5</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
</code></pre></div> <p><strong>Argument 1</strong> : value -2</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>-2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
</code></pre></div> <p><strong>Argument 2</strong> : Data to be written (For this example, data is present in R0. So, we are pushing R0)</p> <div class=highlight><pre><span></span><code><span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
</code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Whenever there is a blank argument or a space to be pushed on to the stack, we follow the convention of pushing R0 on to the stack and the status of stack in the figure will be shown using blank argument only.</p> </div> <p><strong>Argument 3</strong> : Blank /* Push any register */</p> <div class=highlight><pre><span></span><code><span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
</code></pre></div> <p><strong>Storage for Return Value</strong> : Push any register</p> <div class=highlight><pre><span></span><code><span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
</code></pre></div> <p>Now, invoke the trap instruction to invoke the kernel module for console output. The ABI specifies that the interrupt number must be 7.</p> <p><strong>Interrupt Number</strong> : 7 for Write System Call</p> <div class=highlight><pre><span></span><code><span class=nf>INT</span><span class=w> </span><span class=mi>7</span>
</code></pre></div> <p>The status of the stack after the INT instruction will look as shown below</p> <p><img alt src=../img/syscallstack1.png></p> <p>Note that in the above diagram argument 2 is 5 because the contents of the register R0 is 5.</p> <p>The above sequence of instructions will invoke the write system call. Upon successful write operation, the value 0 will be returned to the calling program through the stack. We assume here that the call will be successful.</p> <p>Now upon exit from the system call :</p> <ol> <li>The return value may be retrievied if required.</li> <li>The stack must be set back to the state before the call as stipulated in the ABI. This is necessary to avoid loss of stack space after each call.</li> </ol> <p>The following instructions will do the above.</p> <div class=highlight><pre><span></span><code><span class=c1>// The following code must be executed after return from the system call</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R0</span><span class=w> </span><span class=c1>// Pop and save the return value in some register</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop and discard the argument3</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop and discard the argument2</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop and discard the argument1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop out system call number.</span>
</code></pre></div> <p>The <code>target_file</code> will look as shown below after adding the Write system call.</p> <div class=highlight><pre><span></span><code><span class=err>0</span>
<span class=err>2056</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=mi>3</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=no>R1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>SP</span><span class=p>,</span><span class=w> </span><span class=mi>4095</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>5</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>-2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
<span class=nf>INT</span><span class=w> </span><span class=mi>7</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R0</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
</code></pre></div> <p>Now, having generated the executable program run the program using the simulator. To run the program, follow the instructions given below.</p> <ol> <li>open terminal and navigate to the XSM simulator folder.</li> <li>Type <code>./xsm -e &lt;relative path to target_file.xsm&gt;</code></li> </ol> <p>You can see that the value 5 is printed on the console.</p> <p>Observe that the simulator flagged an error after the last statement was executed. This happened because after executing the last valid instruction in the program, the simulator had no idea that the program had ended and hence tried to fetch the next instruction from memory. However, since there is no valid insturction in that memory location, the machine raises an exception [see <a href=https://exposnitc.github.io/expos-docs/arch-spec/interrupts-exception-handling/ >here</a> for exceptions of XSM] and control was transfered to an exception handler routine of the OS kernel. Typically, in a multitasking environment, the OS will terminate the program, reclaim resources allocated to it and schedule some other process.</p> <p>The exception handler routine of the XSM simulator given to you is designed to print an error message and terminate the simulation.</p> <p>The "proper" way to exit the application is to invoke the exit system call. This will inform the OS that the program has finished execution. The exit system call code of a typical OS kernel will "gracefully" exit the application and schedule other programs for execution. The OS will never return to the application that invokes the exit system call.</p> <p>The exit system call routine of the XSM simulator given to you will print a message indicating successful program execution and terminate the simulation.</p> <div class="admonition tip"> <p class=admonition-title>Important Note</p> <p>The system call code for read, write and exit will modify some of the registers R0, R1 etc. Hence, if you had stored some value into these registers before the call, those values will be lost during the call. Hence, if you wish to restore the values of the registers, the following procedure must be adopted.</p> <ol> <li>Push all registers in current use into the stack. For example, if you wish to retain values of R0, R1 and R2 after the call, push these three registers into the stack.</li> <li>Now, follow procedure outlined earlier to make the system call.</li> <li>After return POP out the registers saved in the stack. (Note that you must pop the registers out in reverse order of push).</li> </ol> </div> <div class="admonition question"> <p class=admonition-title>Exercise 3</p> <p>Follow the instructions in the low level system call interface of the ABI to invoke the <a href=../abi/#nav-lowlevel-syscall-interface>exit system call</a> after the console output in your previous program.</p> </div> <p>So far, there was no need to allocate memory for storing variables as all the data involved were stored in registers. The next exercise requires allocation of storage for variables. Suppose you want <strong>to read a number from the console</strong>, then <strong>the address of a memory location must be passed as the second argument to the read system call (INT 6).</strong> The system call will place the input data into the memory address received as the second argument.</p> <p>Suppose you need three variables to be read, then you may reserve the first three words of the stack (memory addresses 4096, 4097 and 4098) for those variables. <strong>As some portion of the stack is now reserved for variables, the initial value of the stack pointer may be set such that the run time stack begins above the reserved region.</strong> (SP may be set to 4098 here). This ensures that the reserved region is not over-written when the program pushes data into the stack. To read a variable from input, you need to push the address of the memory location reserved for the variable as the second argument (4096 for the first, 4097 for the second, 4098 for the third.) and invoke the read system call. With this strategy, the following exercise can be easily solved.</p> <div class="admonition question"> <p class=admonition-title>Exercise 4</p> <p>Write an XSM assembly language program to read three numbers from the console and print the largest. (Invoke the read system call for console input.)</p> <p>Caution : Ensure that you understand the <strong>important note</strong> written above before starting with the implementation.</p> </div> <div class="admonition question"> <p class=admonition-title> Exercise 5</p> <p>Write an XSM assembly language program to read numbers until a zero is entered and print their sum.</p> </div> <div class="admonition tip"> <p class=admonition-title>Important Note</p> <p>Exercises 4 and 5 essentially ask you to handle conditional and iterative constructs in assembly language. These exercises give insight into how machine code must be genrated for <strong>if-then-else</strong> and <strong>while-do</strong> constructs of programming languages.</p> </div> <h2 id=experiment-iii-understanding-the-library-interface><strong>Experiment III</strong>: Understanding the Library Interface<a class=headerlink href=#experiment-iii-understanding-the-library-interface title="Permanent link">&para;</a></h2> <div class="admonition abstract"> <p class=admonition-title>Prerequisite Reading</p> <p>Read and understand the <a href=../abi/#nav-eXpOS-system-library-interface>library interface</a>.</p> </div> <p>In this experiment, you will learn how to implement the library interface stipulated in the ABI for supporting <strong>read, write and exit system calls</strong>.</p> <p>The <a href=../abi/#nav-virtual-address-space-model>memory address space model</a> of a program reserves the first 1024 words of the address space of a program to load a library. Here we explain the purpose of the library.</p> <p>If we consider C programs, almost every program uses the routines in the library <em>stdio.h</em>. Since in a computer system, several application programs will be running concurrently, it is a good idea to have the code for <em>stdio.h</em> loaded once at bootstrap time into some region of the physical memory and link this memory to the address space of each program's standard library region at load time. This code will be designed once and shared between all applications.</p> <p>The ABI specifies that the ExpOS library for the XSM machine must be linked to address 0 to 1023. The XSM simulator given to you will load the contents of the file <em>library.lib</em> to the addresses 0 - 1023 of your program. The ABI stipulates that the library must support functions for read, write and exit. (The library also must contain functions Alloc, Free and Initialize which will not be discussed here.)</p> <p>To access any library function, an application must transfer control to the code at memory address 0 using the instruction <strong>CALL</strong>. This is the first memory address in the library region. The arguments to the call specify which library function is being invoked. The library interface is specified <a href=../abi/#nav-eXpOS-system-library-interface>here</a>.</p> <p>An application program can execute read, write and exit functions through the library. This means that once the library is implemented, application programs can call the library (CALL 0) to perform read, write and exit operations by passing appropriate function code and arguments. Internally, the library contains code that traps to the Os kernel.</p> <p>One might naturally raise the question – why should we route the system calls through the library than call them directly as was done so far. There are several advantages in using the library. At a later time, if the interrupt number for an OS service – say write – gets modified, only the library needs to be replaced. The compiler need not be modified, nor application programs need re-compilation. Thus, the library provides an abstraction that hides low level details from the compiler and the application.</p> <h3 id=implementation_2>Implementation<a class=headerlink href=#implementation_2 title="Permanent link">&para;</a></h3> <p>In this experiment, we implement the program of Experiment II using the library.</p> <p>Recall that to print the data into the console, we need to:</p> <ol> <li>Push the data(using registers) into the stack along with other arguments to the system call.</li> <li>Invoke the write system call using the INT instruction specifying the appropriate interrupt number.</li> </ol> <p>The step 1 will remain same as in the above experiment. We will implement step 2 using library interface.</p> <p>To use the stack we need to set the stack pointer(SP). Always SP should point the top value of the stack. The XSM machine increments SP immedietely before a PUSH operation by XSM machine and hence the first PUSH operation will be storing data to address 4096. So, we need to initialize SP to 4095.</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>SP</span><span class=p>,</span><span class=w> </span><span class=mi>4095</span>
</code></pre></div> <p>Now, the arguments to a write operation must be pushed on to the stack: Note that the contents which are to be written to the console are present in the register R0. So, we are not using the register R0. <strong>Function Code</strong> : "Write"</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=err>&quot;</span><span class=no>Write</span><span class=err>&quot;</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
</code></pre></div> <p><strong>Argument 1</strong> : value -2 (see <a href=../abi/ >ABI</a> for specification)</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>-2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
</code></pre></div> <p><strong>Argument 2</strong> : Data to be written (For this example, data is present in R0. So, we are pushing R0)</p> <div class=highlight><pre><span></span><code><span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
</code></pre></div> <p><strong>Argument 3</strong> : Blank /* Push any register */</p> <div class=highlight><pre><span></span><code><span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
</code></pre></div> <p><strong>Storage for Return Value</strong> : Push any register</p> <div class=highlight><pre><span></span><code><span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
</code></pre></div> <p>The main difference between the system call interface and the library interface come at the next instruction. If we were using the system call interface, we would have called the interrupt for write (INT 7). Here instead, we will always use <strong>CALL 0</strong> to transfer control to the library. (Remember that library file is loaded in the memory addresses 0 - 1023.). The library understands that the action requested is a write operation by looking at the function code passed as argument (in this case "Write"). If the action requested is a read operation, then "Read" is passed, and so on.</p> <div class=highlight><pre><span></span><code><span class=nf>CALL</span><span class=w> </span><span class=mi>0</span>
</code></pre></div> <p>The status of the stack after the INT instruction will look as shown below</p> <p><img alt src=../img/libcallstack1.png></p> <p>Note that in the above diagram argument 2 is 5 because the contents of the register R0 is 5.</p> <p>The above sequence of instructions will invoke the write system call from the library. Upon successful write operation, the library must retuen value 0 to the calling program through the stack. We assume here that the call will be successful.</p> <p>Now upon exit from the call :</p> <ol> <li>The return value may be retrieved if required.</li> <li>The stack must be set back to the state before the call as stipulated in the ABI. This is necessary to avoid loss of stack space after each call.</li> </ol> <p>The following instructions will do the above.</p> <div class=highlight><pre><span></span><code><span class=c1>// The following code must be executed after return from the system call</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R0</span><span class=w> </span><span class=c1>// Pop and save the return value in some register</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop and discard the argument3</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop and discard the argument2</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop and discard the argument1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>// Pop out the function code.</span>
</code></pre></div> <p>The <code>target_file</code> will look as shown below after adding the Write system call.</p> <div class=highlight><pre><span></span><code><span class=err>0</span>
<span class=err>2056</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=err>0</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=mi>3</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R0</span><span class=p>,</span><span class=w> </span><span class=no>R1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>SP</span><span class=p>,</span><span class=w> </span><span class=mi>4095</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=err>&quot;</span><span class=no>Write</span><span class=err>&quot;</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>-2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R1</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R0</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R1</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R1</span>
<span class=nf>CALL</span><span class=w> </span><span class=mi>0</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R0</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
</code></pre></div> <p>Now we need to write logic in the library file to handle the request for Write system call. Earlier we have created the "library.lib" file with RET instruction alone. Now we will edit this file.</p> <p>When CALL 0 is executed, the IP+2 is pushed on the top of the stack and IP is set to 0. Therefore now IP points to the first instruction of the library file.</p> <p>Since every call to the library points IP to 0 address, we need to have logic to distinguish the type of request at this address. The information regarding the type of request can be found from the function code that is pushed as an argument on the stack. The function code can be obtained from the stack using SP - 5<strong>[Why?]</strong>.</p> <p>In this experiment we are dealing only with "Write" system call, so we will have our discussion only specific to it. After recognising the type of request we need to handle the request in the same way as we did in the previous experiment using system call interface. The arguments to be passed in the system call interface are system call number(5),-2, register holding the value to be written (It is at SP - 3) and a blank argument. The library simply has to copy the arguments 1 to 3 to the system call without any modification.</p> <p>Get the function code from the stack and compare if it is equal to "Write" and get the arguments from the stack.</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>SP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>5</span>
<span class=nf>SUB</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>R2</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=err>&quot;</span><span class=no>Write</span><span class=err>&quot;</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span>
<span class=nf>EQ</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>R2</span>
<span class=nf>JZ</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>62</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>SP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>4</span>
<span class=nf>SUB</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>R2</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span><span class=w> </span><span class=c1>//argument 1 at SP - 4</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R3</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span><span class=w> </span><span class=c1>//argument 2 at SP - 3</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R4</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span><span class=w> </span><span class=c1>//argument 3 at SP - 2</span>
</code></pre></div> <p>Once you get the arguments, the procedure to invoke the system call is same as we did in the earlier experiment.</p> <div class=highlight><pre><span></span><code><span class=cm>/* pushing arguments and space for return value for system call */</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R5</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=w> </span><span class=c1>//System call number 5 for Write</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R5</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span><span class=w> </span><span class=c1>//R2 contains [SP - 4] = -2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R3</span><span class=w> </span><span class=c1>//R3 contains [SP - 3] = 5 // Contains Value</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R4</span><span class=w> </span><span class=c1>//R4 contains [SP - 2] = blank</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R5</span><span class=w> </span><span class=c1>// space for return value</span>

<span class=cm>/* trap instruction */</span>
<span class=nf>INT</span><span class=w> </span><span class=mi>7</span>

<span class=cm>/* Pop the arguments and return value */</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span><span class=w> </span><span class=c1>//Pop and save return value</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span><span class=w> </span><span class=c1>//Pop and discard</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span><span class=w> </span><span class=c1>//Pop and discard</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span><span class=w> </span><span class=c1>//Pop and discard</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span><span class=w> </span><span class=c1>//Pop and discard</span>
</code></pre></div> <p>The return value of the library is the same as the return value of the system call. Hence the library must copy the return value of the system call back to the application as its own return value through the stack.</p> <div class=highlight><pre><span></span><code><span class=cm>/* Storing the return value on the top of the stack */</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=no>SP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R3</span><span class=p>,</span><span class=w> </span><span class=mi>1</span>
<span class=nf>SUB</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=no>R3</span>
<span class=nf>MOV</span><span class=w> </span><span class=p>[</span><span class=no>R2</span><span class=p>],</span><span class=w> </span><span class=no>R1</span>
<span class=c1>// [SP - 1] = R1 (Return value was popped to R1 earlier) RET</span>
</code></pre></div> <p>The library.lib file will look as shown below after adding the code to handle Write system call.</p> <div class=highlight><pre><span></span><code><span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>SP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>5</span>
<span class=nf>SUB</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>R2</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=err>&quot;</span><span class=no>Write</span><span class=err>&quot;</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span>
<span class=nf>EQ</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>R2</span>
<span class=nf>JZ</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>62</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>SP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=mi>4</span>
<span class=nf>SUB</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=no>R2</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R3</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span>
<span class=nf>ADD</span><span class=w> </span><span class=no>R1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R4</span><span class=p>,</span><span class=w> </span><span class=p>[</span><span class=no>R1</span><span class=p>]</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R5</span><span class=p>,</span><span class=w> </span><span class=mi>5</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R5</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R2</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R3</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R4</span>
<span class=nf>PUSH</span><span class=w> </span><span class=no>R5</span>
<span class=nf>INT</span><span class=w> </span><span class=mi>7</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R1</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span>
<span class=nf>POP</span><span class=w> </span><span class=no>R2</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=no>SP</span>
<span class=nf>MOV</span><span class=w> </span><span class=no>R3</span><span class=p>,</span><span class=w> </span><span class=mi>1</span>
<span class=nf>SUB</span><span class=w> </span><span class=no>R2</span><span class=p>,</span><span class=w> </span><span class=no>R3</span>
<span class=nf>MOV</span><span class=w> </span><span class=p>[</span><span class=no>R2</span><span class=p>],</span><span class=w> </span><span class=no>R1</span>
<span class=nf>RET</span>
</code></pre></div> <div class="admonition tip"> <p class=admonition-title>Important note</p> <p>Your library code for read, write and exit may modify some of the registers R0, R1 etc. Hence, if you had stored some values into these registers before the call, those values will be lost while the library code is executed. To safely restore the values of the registers, the following procedure must be adopted.</p> <ol> <li>Push all registers in current use into the stack. For example, if you wish to retain values of R0, R1 and R2 after the call, push these three registers into the stack.</li> <li>Now, code the library call and return steps.</li> <li>After return POP out the registers saved in the stack. (Note that you must pop the registers out in reverse order of push).</li> </ol> </div> <div class="admonition question"> <p class=admonition-title>Exercise 6</p> <p>Implement <code>read()</code> and <code>exit()</code> functions of the library.</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 7</p> <p>Modify the program to read three numbers from the console and print the largest to perform I/O using the library interface.</p> </div> <div class="admonition question"> <p class=admonition-title>Exercise 8</p> <p>Modify the program to read numbers until a zero is entered from the console and print their sum to perform I/O using the library interface.</p> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=https://creativecommons.org/licenses/by-nc/4.0/ rel=license> <img alt="Creative Commons License" style=border-width:0 src=https://licensebuttons.net/l/by-nc/4.0/80x15.png> </a> National Insititute of Technology, Calicut </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/silcnitc target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://groups.google.com/g/expl-users target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 488 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488 261.8C488 403.3 391.1 504 248 504 110.8 504 0 393.2 0 256S110.8 8 248 8c66.8 0 123 24.5 166.3 64.9l-67.5 64.9C258.5 52.6 94.3 116.6 94.3 256c0 86.5 69.1 156.6 153.7 156.6 98.2 0 135-70.4 140.8-106.9H248v-85.3h236.1c2.3 12.7 3.9 24.9 3.9 41.4z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.tabs", "navigation.top", "navigation.sections"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.fe8b6f2b.min.js></script> </body> </html>